// Generated by CoffeeScript 1.8.0
(function() {
  var deletePosition;

  jQuery(function() {
    console.log('Position script ran!');
    $('#add-position-button').click((function(_this) {
      return function(e) {
        var field, fields, postData, _i, _len, field_names;
        e.preventDefault();
        field_names = ['Position Name', 'Election', 'Organization'];
        fields = [$('#input-position'), $('#input-position-election'), $('#input-position-organization')];
        for (_i = 0, _len = fields.length; _i < _len; _i++) {
          field = fields[_i];
          if (field.val().trim() === "") {
            alert('Missing: ' + field_names[_i]);
            return;
          }
        }
                
        postData = {
          'title': fields[0].val(),
          'election': fields[1].val(),
          'organization': fields[2].val()
        };
        return $.ajax({
          url: '/positions',
          type: 'POST',
          data: {
            'data': JSON.stringify(postData)
          },
          success: function(data) {
            var html, response;
            response = JSON.parse(data);
            
            if (response['id'] == 'Duplicate Position') {
              return alert('Duplicate Position');
            }
            else {
              html = $("<div class='alert alert-info' data-id='" + response['id'] + "'> <button type='button' class='close deletePosition' data-dismiss='alert'>"
							+ "&times;</button> <h5>" + response['title'] + "</h5> </div>");
							
							var election = response['election'].split('-')[0];
							election = election.substring(0, election.length - 1);
							election = election.replace(/\s/g,'');
							var id = '#' + election;

							$(id).prepend(html);
              
              html.hide().slideDown(500);
              return html.children('button[class="close deletePosition"]').click(deletePosition);
            }
          }
        });
      };
    })(this));
    $('button[class="close deletePosition"]').click(deletePosition);
  });

  deletePosition = function(e) {
    var position, position_id;
    position = $(this).parent();
    position_id = position.attr('data-id');
    return $.ajax({
      url: '/positions/delete',
      type: 'POST',
      data: {
        'id': position_id
      },
      success: function(data) {
        if (data === 'Success!') {
          return position.slideUp(500);
        }
      }
    });
  };

}).call(this);
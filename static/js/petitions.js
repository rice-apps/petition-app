// Generated by CoffeeScript 1.4.0
var deletePetition;

jQuery(function() {
  var _this = this;
  console.log('Script ran');
  $('#add-button').click(function(e) {
    var field, fields, postData, _i, _len;
    e.preventDefault();
    fields = [$('#input-title'), $('#input-text')];
    for (_i = 0, _len = fields.length; _i < _len; _i++) {
      field = fields[_i];
      if (field.val().trim() === "") {
        alert('Missing input');
        return;
      }
    }
    postData = {
      'title': fields[0].val(),
      'note': fields[1].val()
    };
    return $.ajax({
      url: '/petitions',
      type: 'POST',
      data: {
        'data': JSON.stringify(postData)
      },
      success: function(data) {
        var html, id, note, response, title;
        response = JSON.parse(data);
        id = response['id'];
        title = response['title'];
        note = response['note'];
        html = $("                    <div class='alert' data-id='" + id + "'>                    <button type='button' class='close' data-dismiss='alert'>&times;</button>                    <h4>" + title + "</h4>                    <p>" + note + "</p>                    </div>");
        $('#petitions').prepend(html);
        html.hide().slideDown(500);
        return html.children('button[class="close"]').click(deletePetition);
      }
    });
  });
  return $('button[class="close"]').click(deletePetition);
});

deletePetition = function(e) {
  var petition, petition_id;
  petition = $(this).parent();
  petition_id = petition.attr('data-id');
  return $.ajax({
    url: '/petitions/delete',
    type: 'POST',
    data: {
      'id': petition_id
    },
    success: function(data) {
      if (data === 'Success!') {
        return petition.slideUp(500);
      }
    }
  });
};

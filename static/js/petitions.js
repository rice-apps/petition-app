// Generated by CoffeeScript 1.8.0
(function() {
  var deletePetition, unvotePetition, votePetition;

  jQuery(function() {
    console.log('Script ran');
    $('#add-button').click((function(_this) {
      return function(e) {
        var field, fields, postData, _i, _len;
        e.preventDefault();
        fields = [$('#input-title'), $('#input-text'), $('#org-name'), $('#org-email')];
        for (_i = 0, _len = fields.length; _i < _len; _i++) {
          field = fields[_i];
          if (field.val().trim() === "") {
            alert('Missing input');
            return;
          }
        }
        postData = {
          'title': fields[0].val(),
          'note': fields[1].val(),
		  'org-name': fields[2].val(),
		  'org-email': fields[3].val()
        };
        return $.ajax({
          url: '/petitions',
          type: 'POST',
          data: {
            'data': JSON.stringify(postData)
          },
          success: function(data) {
            var html, id, note, response, title;
            response = JSON.parse(data);
            id = response['id'];
            title = response['title'];
            note = response['note'];
			
            html = $("<div class='alert' data-id='" + id + "'> <button type='button' class='close' data-dismiss='alert'>&times;</button> <h4>" + title + "</h4> <h6>0</h6> <p>" + note + "</p> <button type='button' id='vote-button' class='btn btn-mini'>Vote</button> </div>");
            $('#petitions').prepend(html);
            html.hide().slideDown(500);
            return html.children('button[class="close"]').click(deletePetition);
          }
        });
      };
    })(this));
    $('button[class="close"]').click(deletePetition);
    $('button[id="vote-button"]').click(votePetition);
    return $('#unvote-button').click(unvotePetition);
  });

  votePetition = function(e) {
    var petition, petition_id;
    console.log('Script ran!');
    petition = $(this).parent();
    petition_id = petition.attr('data-id');
    return $.ajax({
      url: '/petitions/vote',
      type: 'POST',
      data: {
        'id': petition_id
      },
      success: function(data) {
        if (data === 'Successfully voted!') {
          return alert('Voted successfully!');
        }
		if (data === 'You cannot vote on your own petition!') {
			return alert('You cannot vote on your own petition!');
			}
      }
    });
  };

  unvotePetition = function(e) {
    var petition, petition_id;
    console.log('Script ran!');
    petition = $(this).parent();
    petition_id = petition.attr('data-id');
    return $.ajax({
      url: '/petitions/unvote',
      type: 'POST',
      data: {
        'id': petition_id
      },
      success: function(data) {
        if (data === 'Successfully unvoted!') {
          return alert('Unvoted successfully!');
        }
        if (data === 'You cannot unvote your own petition!') {
          return alert('You cannot unvote your own petition!');
        }
      }
    });
  };

  deletePetition = function(e) {
    var petition, petition_id;
    petition = $(this).parent();
    petition_id = petition.attr('data-id');
    return $.ajax({
      url: '/petitions/delete',
      type: 'POST',
      data: {
        'id': petition_id
      },
      success: function(data) {
        if (data === 'Success!') {
          return petition.slideUp(500);
        }
      }
    });
  };

}).call(this);

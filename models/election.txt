"""
Model definition and functions for petitions.
"""

__author__ = 'Xiaoyu Chen <xc12@rice.edu>'

from google.appengine.ext import db
from user import User
from datetime import date, timedelta
from controllers.netid2name import netid2name
class Petition(db.Model):
    
    user = db.ReferenceProperty(User, required=True)
    name = db.StringProperty(required=True)
    date_added = db.DateProperty(auto_now=True)
    email = db.StringProperty(required=True)
    message = db.TextProperty()
    election = db.StringProperty(required=True)
    organization = db.StringProperty(required=True)
    position = db.StringProperty(required=True)
    signature_num = db.IntegerProperty(default = 0)
    signatures = db.ListProperty(str)
    
    def to_json(self):
        return {
            'user': self.user,
            'name': self.name,
            'id': str(self.key()),
            'email': self.email,
            'message': self.message,
            'election': self.election,
            'organization': self.organization,
            'position': self.position,
            'signature_num': self.signature_num,
            'signatures': self.signatures
           }

    def get_signature_num(self):
        return self.signature_num
    def get_signatures(self):
        return self.signatures
    def get_user(self):
        return self.user
    def get_election(self):
        return self.election
    def get_organization(self):
        return self.organization
    def get_position(self):
        return self.position
    
    def add_signature(self, signee):
        net_id = signee.get_id()
        if net_id not in self.signatures:
          self.signatures.append(net_id)
          self.signature_num += 1
          self.put()
          return True
        else:
          return False
          
    def remove_signature(self, signee):
        net_id = signee.get_id()
        if net_id in self.signatures:
          self.signatures.remove(net_id)
          self.signature_num -= 1
          self.put()
          return True
        else:
          return False